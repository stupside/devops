---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cilium-hubble
  namespace: cilium-system
data:
  values.yaml: |
    hubble:
      enabled: true
      relay:
        enabled: true
      ui:
        enabled: true
        service:
          type: ClusterIP
      tls:
        enabled: true
        auto:
          method: certmanager
          certValidityDuration: 365
          certManagerIssuerRef:
            group: cert-manager.io
            name: selfsigned
            kind: ClusterIssuer
      metrics:
        enabled:
          - dns
          - drop
          - tcp
          - flow
          - port-distribution
          - icmp
          - "httpV2:exemplars=true;labelsContext=source_ip,source_namespace,source_workload,destination_ip,destination_namespace,destination_workload,traffic_direction"
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: hubble-ui
  namespace: cilium-system
spec:
  parentRefs:
    - name: infrastructure
  hostnames:
    - "hubble.${cluster_domain}"
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: hubble-ui
          port: 80
