apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - crds
  - network
  - storage
  - database
  - security
  - platform

# Apply common defaults to all HelmReleases (FluxCD v2.7+)
# Using strategic merge patch for proper nested field handling
patches:
  - target:
      kind: HelmRelease
    patch: |-
      apiVersion: helm.toolkit.fluxcd.io/v2
      kind: HelmRelease
      metadata:
        name: not-used
      spec:
        timeout: 10m
        install:
          remediation:
            retries: 3
        upgrade:
          cleanupOnFail: true
          remediation:
            retries: 3
        driftDetection:
          mode: enabled
